<div class="row">
  <div class="col-lg-12">
    <ol class="ember-view breadcrumbs breadcrumb">
      <li class="first current">
        {{#link-to 'admin.index' }}home{{/link-to}}
      </li>
      <li class="first current">
        {{#link-to 'theme.themesList' theme}}themes{{/link-to}}
      </li>
      <li class="first current">
        {{#link-to 'theme.themeSettings' theme}}{{theme}}{{/link-to}}
      </li>
    </ol>
  </div>
  <div class="col-lg-12">
    <h1 class="page-header">Layout - {{data.layout}}</h1>
  </div>
  <!-- /.col-lg-12 -->
</div>
{{#each data.regions}}
  <div class="panel panel-default">
    <div class="panel-heading">{{this.name}}</div>
    <div class="panel-body">
      <table class="table table-striped table-bordered table-hover sorted_table" id="dataTables-example">
        <thead>
          <tr>
            <th></th>
            <th>ID</th>
            <th>Title</th>
            <th>Widget Name</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody class="ui-sortable">
          {{#each widgets}}
            <tr model-widget="{{id}}" class="ui-state-default ui-sortable-handle" data-id="{{id}}" data-weight="{{weight}}">
              <td style="width: 30px; cursor: move;"><span class="glyphicon glyphicon-resize-vertical"></span></td>
              <td><bind model-widget-{{id}}="id">{{id}}</bind></td>
              <td><bind model-widget-{{id}}="title">{{title}}</bind></td>
              <td><bind model-widget-{{id}}="type">{{type}}</bind></td>
              <td>
                <button we-action="event" event="update-widget-modal" model-id="{{id}}" type="button" class="btn btn-primary">Edit</button>
                <a href="" we-action="event" event="model-delete-widget" model="widget" model-id="{{id}}" class="btn btn-default">Delete</a>
              </td>
            </tr>
          {{/each}}
        </tbody>
      </table>
    </div>
  </div>
{{else}}
  No regions found
{{/each}}

<div class="panel panel-green">
  <div class="panel-heading">Widgets</div>
  <div class="panel-body">

    <div class="dataTable_wrapper">
      <table class="table table-striped table-bordered table-hover" id="dataTables-example">
        <thead>
          <tr>
            <th>Widget Name</th>
            <th>Regions</th>
          </tr>
        </thead>
        <tbody>
          {{#each data.widgets}}
            <tr>
              <td>{{type}}</td>
              <td>
                <form id="form-add-region-to-{{@key}}" name="layout-widget-selector" class="form-inline">
                  <span>Add in regions:</span>
                  <input type="hidden" name="type" value="{{type}}" />
                  <input type="hidden" name="theme" value="{{../data.themeName}}" />
                  <input type="hidden" name="layout" value="{{../data.layout}}" />

                  <select name="regionName" class="form-control">
                    {{#each ../data.regions}}
                      <option value="{{@key}}"> {{this.name}}</option>
                    {{/each}}
                  </select>
                  <button class="btn btn-default">Add</button>
                </form>
              </td>
            </tr>
          {{/each}}
        </tbody>
      </table>
    </div>
  </div>
</div>

<div id="AddWidgetFormModal" class="modal" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
        <h4 class="modal-title">Add widget</h4>
      </div>
      <div class="modal-body">
        <p>Loading ...</p>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  $(function() {
    var sortableList = $('.sorted_table > tbody');
    // Sortable rows
    sortableList.sortable({
      update: function( event, ui ) {
        saveOrder(this)
      }
    });
    function saveOrder(tbody) {
      var widgets = [];
      var list = $(tbody).children('tr');

      for (var i = 0; i < list.length; i++) {
        widgets.push({
          id: $(list[i]).attr('model-id'), weight: i
        });

        $(list[i]).attr('data-weight', i);
      }

      $.ajax({
        url: '/api/v1/widget-sort?responseType=json',
        method: 'POST',
        dataType: 'json',
        contentType: "application/json; charset=utf-8",
        data: JSON.stringify({ widgets: widgets })
      }).done(function(r) {
        console.log('Done sort widgets', r);
      });
    }
  });
</script>